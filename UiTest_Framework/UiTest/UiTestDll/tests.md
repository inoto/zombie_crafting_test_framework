# мысли
* нужно ли тестировать конфиги?
* можно ли менять конфиги?


# сущности
## деревья
## игрок
## станок для переработки дерева

# деревья
1. Для рубки дерева в инвентаре должен присутствовать топор
2. Дерево не срубается за меньше чем 3 заруба топором.
3. Дерево срубается за 3 заруба топором.
4. Когда дерево срублено, фокус на этом дереве пропадает.
5. Когда игрок срубил дерево, ему добавляется 3 бревна в инвентарь.

# игрок
1. игрок может перемещаться использую джойстик
2. фокус игрока на объекте
3. смена фокуса при смене на другой объект
4. выход из фокуса
5. кнопка действия активна/не активна при входе в область/выходе из области предмета

## инвентарь
1. окно инвентаря показывается
2. окно инвентаря закрывается
3. предметы можно удалять. Для этого надо кликнуть предмет, а потом кликнуть ведро
4. предметы можно перемещать по инвентарю
5. все слоты инвентаря доступны для предметов
6. предметы определённого типа стакаются вместе
7. максимальный размер стака для материалов - 20
8. не стакающийся тип предметов не стакается

# станок
1. окно станка открывается
2. окно станка закрывается
3. станок обрабатывает предмет
4. станок не обрабатывает материал, если ячейка результата занята
5. предмет в ячейке результата стакается
6. обработка прерывается/продолжается если поставить/убрать не подходящий результат
7. искомый предмет можно убрать, чтобы прервать обработку
8. обработку можно ускорить с помощью кнопки, стоит 5 монет
9. нельзя ускорить обработку если не хватает монет
10. монеты тратятся при ускорении обработки
11. ускорение обработки мгновенно завершает процесс обработки
12. предмет в ячейке результата может стакаться до размера стака результата
13. обработка не идёт для предметов не из схем обработки
14. результатом обработки является материал из схемы обработки


# баги (поставить приоритеты)
2. Деревья рубятся без топора. При этом иконка действия не активна, но на неё можно нажать, дерево будет рубиться и срубится, как если бы в инветаре был топор.
3. Станок для обработки дерева не правильно учитывает предметы в правом слоте. Если положить в правый слот монеты, а потом в левый слот положить брёвна, то бревно обработается в монету. Critical
4. В инвентаре не подсвечивается выбранный предмет. Low
5. При ускорении обработки дерева прогресс обработки не сбрасывается.
6. (спорно, надо обсуждать) При попадании стакающегося предмета в инвентарь предмет кладётся в отдельный слот. Уже находящийся предмет должен быть помещён не в первую свободную ячейку.
7. Иногда дерево не срубается по окончанию рубки.
8. Ускорениу обработки дерева работает даже если не хватает монет. При этом монеты в инвентаре уходят в минус.
9. Cлоты инвентаря [16, 17, 21, 22] ведут себя странно - эксепшн при попытке обновить контент ячейки. когда переносишь туда предмет, то предмет остаётся на начальной позиции. При этом ячейка становится занята, но показывается как пустая. Происходит как будто клонирование

{"tag":"info","depth":0,"time":"2021-4-29 01:00:45","data":{"name":"Final Error","traceback":"Exception: NullReferenceException: Object reference not set to an instance of an object\nCore.Controllers.CellController.RefreshContent () (at <31bdb29d12e9483b91fc3f056fe35760>:0)\nCore.Controllers.CellController.OnCellChanged () (at <31bdb29d12e9483b91fc3f056fe35760>:0)\nCore.Inventories.Cell.set_Stack (Core.Inventories.Stack value) (at <31bdb29d12e9483b91fc3f056fe35760>:0)\nCore.InventoryBehavior.AddToInventory (Core.Inventories.Inventory target, Core.Inventories.Stack stack) (at <31bdb29d12e9483b91fc3f056fe35760>:0)\nAssets.UiTest.Scripts.Cheats.GetAxe (System.Int32 amount) (at <31bdb29d12e9483b91fc3f056fe35760>:0)\nAssets.UiTest.TestSteps.InventoryFullnessStep+<OnRun>d__2.MoveNext () (at <316f6727d05f4a6e9845e5b4b66bf24d>:0)\nUiTest.UiTest.Coroutine.UiTestCoroutine.Run () (at <316f6727d05f4a6e9845e5b4b66bf24d>:0)\nUiTest.UiTest.Coroutine.Scheduler.Update () (at <316f6727d05f4a6e9845e5b4b66bf24d>:0)\nAssets.UiTest.Scripts.UiTestRun.Update () (at <31bdb29d12e9483b91fc3f056fe35760>:0)\n"}}

Если потом закрыть и открыть инвентарь, то он больше не закрывается - Blocker!

11. В конфиге спрайтов нету иконок, которые в ТЗ. !НЕ CellFrame
    - tool_hatchet_iron
    - Icon_Coin
    - res_wood_1
    - res_plank_1
12. Чит CellSearchByIcon не работает - вываливает NullReferenceException, когда передаём Context.Commands.CellSearchByIconCommand("tool", "1", new HashSet<string>() {"inventory_count"}, result);
Я сделал свой через .GetComponentsInChildren<Image>, но можно добавить определение CellContainer во вреймворке.

Каюсь - почти для всех багов нашёл рут козы, в основном через изучение декомпилированного кода клиента.


# улучшение фреймворка
1. Зарефакторить Commands.cs: вынести куда-нибудь повторяющиеся действия (идеально вынести всё что до и после Run выполняться в коде команде, но тогда хз как лучше поступить в контекстом, чтобы логи писать), CommandsId можно, например, генерить через рефлексию.
2. log.txt переименовать в report.txt, чтобы не путало.
3. (спорно) Некоторые тестовые команды можно сделать обычными методами, потому что внутри они не используют yield return
4. прям не хватает setup & teardown методов
5. вижу проблемы что между степами трудно передать данные, видел есть _reportDict в Context, но не пробовал использовать. В идеале бы конечно сделать так, чтобы из степа можно было брать, а не из контекста
6. Вообще, честно говоря, я бы фреймворк переписал на питоне. Использовал бы читы и кастомные команды.
7. Прокинуть OnApplicationQuit из клиента во вреймворк
8. Можно сделать генерацию Id шагов автоматически.

# что я улучшил (по моему мнению :D)
* добавил вывод степа перед фейлом в log.txt
* для чекера CellCount добавил GetCellCount() метод
* добавил команду WaitWorkbenchSawmillProgressCompleteCommand
* переименовал некоторые методы в Context, чтобы лучше отражало свои функции

# to do
* удалить New команду - нафиг не нужна
* пройтись по первым тестам и обновить
* пройтись по номерам тест кейсов
* пронумировать тесты в свите
* сделал TimeOut и GetArgs() в шагах виртуальными, чтобы не переопределять для каждого шага
*  
