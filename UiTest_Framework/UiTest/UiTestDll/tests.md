# мысли
* нужно ли тестировать конфиги?
* можно ли менять конфиги?


# сущности
## деревья
## игрок
## станок для переработки дерева

# деревья
1. Для рубки дерева в инвентаре должен присутствовать топор
2. Если совершено меньше 3 зарубов по дереву, то дерево продолжает стоять, бревно не добавляется в инвентарь.
3. Дерево срубается за 3 заруба топором.
4. Когда дерево срублено, фокус на этом дереве пропадает
5. Когда игрок срубил дерево, ему добавляется 3 бревна в инвентарь.

# игрок
1. Игрок может перемещаться использую джойстик
2. При окончании фокуса на объекте (например срубки дерева), фокус должен перейти на другой объект (например на другое дерево)
3. кнопка действия активна/не активна

## инвентарь
1. окно инвентаря показывается
2. окно инвентаря закрывается
3. предметы можно удалять. Для этого надо кликнуть предмет, а потом кликнуть ведро
4. предметы можно перемещать по инвентарю
6. предметы типа ресурсов стакаются вместе
7. нельзя взять предметы, если инвентарь заполнен
8. Максимальный размер стака для материалов - 20.
9. Предмет можно положить в любой слот инвентаря.
11. 


# станок
1. окно станка открывается
2. окно станка закрывается
3. в станок можно поместить дерево для обработки, в левый слот
4. можно забрать дерево во время обработки, тогда процесс прервётся
5. дерево, помещённое для обработки, будет обработано. Обработанное дерево появится в правом слоте
6. обработку можно ускорить, использовав монеты. Монеты должны находится в инвентаре. Тратится 5 монет на ускорение
7. нельзя ускорить обработку, если не хватает монет
8. Обрабатываться должны только материалы ресурсов, например брёвна. Монеты, инструменты и другие подобные предметы не должны отрабатываться, хотя их можно положить в левый слот
9. Предметы должны обрабатываться только по схемам. Если сначала заполнить правый слот монетами, а потом в левый положить брёвна, то обработка не должна начаться.
10. Правый слот должен быть свободным, или иметь такой же тип предмета, который должен получится в конце обработки, чтобы обработка прошла успешно. Если положить в левый слот брёвна то начнётся обработка. Сразу же надо положить в правый слот инструмент (например топор), тогда обработка должна прерваться. При этом Если убрать инструмент из правого слота, то обработка должна продолжиться. 
11. Предметы в слотах можно заменять в любой момент времени. Если заменить предмет по время обработки дерева на неподходящий предмет, то обработка должна прерваться.
12. Обработку можно предвать. Начать обработку бревна и через секунду 
13. Когда правый слот заполняется максимальным размером стака нужного предмета, то обработка дальше не идёт.
14. Ускорение должно работать только если есть предмет в левом слоте и этот предмет обрабатывается.
15. Прогресс обработки показывается
16. 


# баги (поставить приоритеты)
2. Деревья рубятся без топора. При этом иконка действия не активна, но на неё можно нажать, дерево будет рубиться и срубится, как если бы в инветаре был топор.
3. Станок для обработки дерева не правильно учитывает предметы в правом слоте. Если положить в правый слот монеты, а потом в левый слот положить брёвна, то бревно обработается в монету. Critical
4. В инвентаре не подсвечивается выбранный предмет. Low
5. При ускорении обработки дерева прогресс обработки не сбрасывается.
6. (спорно, надо обсуждать) При попадании стакающегося предмета в инвентарь предмет кладётся в отдельный слот. Уже находящийся предмет должен быть помещён не в первую свободную ячейку.
7. Иногда дерево не срубается по окончанию рубки.
8. Ускорениу обработки дерева работает даже если не хватает монет. При этом монеты в инвентаре уходят в минус.
9. Cлоты инвентаря [16, 17, 21, 22] ведут себя странно - эксепшн при попытке обновить контент ячейки. когда переносишь туда предмет, то предмет остаётся на начальной позиции. При этом ячейка становится занята, но показывается как пустая. Происходит как будто клонирование

{"tag":"info","depth":0,"time":"2021-4-29 01:00:45","data":{"name":"Final Error","traceback":"Exception: NullReferenceException: Object reference not set to an instance of an object\nCore.Controllers.CellController.RefreshContent () (at <31bdb29d12e9483b91fc3f056fe35760>:0)\nCore.Controllers.CellController.OnCellChanged () (at <31bdb29d12e9483b91fc3f056fe35760>:0)\nCore.Inventories.Cell.set_Stack (Core.Inventories.Stack value) (at <31bdb29d12e9483b91fc3f056fe35760>:0)\nCore.InventoryBehavior.AddToInventory (Core.Inventories.Inventory target, Core.Inventories.Stack stack) (at <31bdb29d12e9483b91fc3f056fe35760>:0)\nAssets.UiTest.Scripts.Cheats.GetAxe (System.Int32 amount) (at <31bdb29d12e9483b91fc3f056fe35760>:0)\nAssets.UiTest.TestSteps.InventoryFullnessStep+<OnRun>d__2.MoveNext () (at <316f6727d05f4a6e9845e5b4b66bf24d>:0)\nUiTest.UiTest.Coroutine.UiTestCoroutine.Run () (at <316f6727d05f4a6e9845e5b4b66bf24d>:0)\nUiTest.UiTest.Coroutine.Scheduler.Update () (at <316f6727d05f4a6e9845e5b4b66bf24d>:0)\nAssets.UiTest.Scripts.UiTestRun.Update () (at <31bdb29d12e9483b91fc3f056fe35760>:0)\n"}}

Если потом закрыть и открыть инвентарь, то он больше не закрывается - Blocker!

11. В конфиге спрайтов нету иконок, которые в ТЗ. !НЕ CellFrame
    - tool_hatchet_iron
    - Icon_Coin
    - res_wood_1
    - res_plank_1
12. Чит CellSearchByIcon не работает - вываливает NullReferenceException, когда передаём Context.Commands.CellSearchByIconCommand("tool", "1", new HashSet<string>() {"inventory_count"}, result);

Каюсь - почти для всех багов нашёл рут козы, в основном через изучение декомпилированного кода клиента.


# улучшение фреймворка
1. Зарефакторить Commands.cs: вынести куда-нибудь повторяющиеся действия (идеально вынести всё что до и после Run выполняться в коде команде, но тогда хз как лучше поступить в контекстом, чтобы логи писать), CommandsId можно, например, генерить через рефлексию.
2. log.txt переименовать в result.txt, чтобы не путало.
3. (спорно) Некоторые тестовые команды можно сделать обычными методами, потому что внутри они не используют yield return
4. прям не хватает setup & teardown методов

# что я улучшил
* добавил возможность запуска набора тестов друг за другом. Если тест фейлится, то запускается следующий
* добавил вывод степа перед фейлом в log.txt
